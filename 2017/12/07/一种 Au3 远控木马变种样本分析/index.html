<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="威胁分析,">










<meta name="description" content="转自&amp;nbsp;王小龍的博客 1&amp;nbsp;Au3&amp;nbsp;简介&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AutoIt3&amp;nbsp;（简称&amp;nbsp;Au3）是一种能够在&amp;nbsp;Windows&amp;nbsp;GUI&amp;nbsp;或&amp;nbsp;DOS&amp;nbsp;上实现一系列自动化任务的脚本语言，其语法类似BASIC。 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用&amp;nbsp;Au3&amp;nb">
<meta name="keywords" content="威胁分析">
<meta property="og:type" content="article">
<meta property="og:title" content="一种 Au3 远控木马变种样本分析">
<meta property="og:url" content="http://blog.bruce.wang/2017/12/07/一种 Au3 远控木马变种样本分析/index.html">
<meta property="og:site_name" content="BruceWang&#39;s Blog">
<meta property="og:description" content="转自&amp;nbsp;王小龍的博客 1&amp;nbsp;Au3&amp;nbsp;简介&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AutoIt3&amp;nbsp;（简称&amp;nbsp;Au3）是一种能够在&amp;nbsp;Windows&amp;nbsp;GUI&amp;nbsp;或&amp;nbsp;DOS&amp;nbsp;上实现一系列自动化任务的脚本语言，其语法类似BASIC。 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用&amp;nbsp;Au3&amp;nb">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-8bf967ce8a9f0572.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-52e43245bfe5c95d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-884b8294f64689f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-0e732f768038e6ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-85971a2a2c5e7fc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-ee2b1954c7c76d2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-8ab1ec5181a89622.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-ab6459766840f93d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-c059edfbacc7aeb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-0e7b85b5115a8d5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-97020eb9e8bea4a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-a313259bbf55721f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-18672639d7b95e67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-3ed90c0a226a189a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-2dd4ee5bddad2309.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-9becf5d2b9023bd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-03a73eb7820dafc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-ec7c67f60ce68bc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-45742dc23804c34d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-4521cfc7c1f07e47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-708b07ffac3166e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-4e7f1a977d616fc6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-b1ae5e89d5c4af53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-012f63647234ded0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-c360cdccd482aca0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-0b21a0b33b6aac61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-3390b90224628fbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-ba036f187d257473.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/7053164-29efa904d6b5b27e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-07-15T06:13:03.447Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="一种 Au3 远控木马变种样本分析">
<meta name="twitter:description" content="转自&amp;nbsp;王小龍的博客 1&amp;nbsp;Au3&amp;nbsp;简介&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AutoIt3&amp;nbsp;（简称&amp;nbsp;Au3）是一种能够在&amp;nbsp;Windows&amp;nbsp;GUI&amp;nbsp;或&amp;nbsp;DOS&amp;nbsp;上实现一系列自动化任务的脚本语言，其语法类似BASIC。 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用&amp;nbsp;Au3&amp;nb">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/7053164-8bf967ce8a9f0572.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.bruce.wang/2017/12/07/一种 Au3 远控木马变种样本分析/">





  <title>一种 Au3 远控木马变种样本分析 | BruceWang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BruceWang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">王小龍的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.bruce.wang/2017/12/07/一种 Au3 远控木马变种样本分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BruceWang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BruceWang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">一种 Au3 远控木马变种样本分析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-07T11:11:11+08:00">
                2017-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/威胁情报/" itemprop="url" rel="index">
                    <span itemprop="name">威胁情报</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>转自&nbsp;<a href="http://blog.bruce.wang">王小龍的博客</a></p>
<h2 id="1-nbsp-Au3-nbsp-简介"><a href="#1-nbsp-Au3-nbsp-简介" class="headerlink" title="1&nbsp;Au3&nbsp;简介"></a>1&nbsp;Au3&nbsp;简介</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;AutoIt3&nbsp;（简称&nbsp;Au3）是一种能够在&nbsp;Windows&nbsp;GUI&nbsp;或&nbsp;DOS&nbsp;上实现一系列自动化任务的脚本语言，其语法类似BASIC。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;使用&nbsp;Au3&nbsp;开发的程序，能够具有以下功能：</p>
<ul>
<li>模拟击键和鼠标移动操作；</li>
<li>对窗口和进程进行操作；</li>
<li>与所有标准的&nbsp;Windows&nbsp;控件进行交互。</li>
<li>编译的独立可执行文件无需安装任何运行环境。</li>
<li>可创建图形用户界面（&nbsp;GUI&nbsp;）；</li>
<li>支持&nbsp;COM&nbsp;；</li>
<li>支持正则表达式；</li>
<li>可直接调用外部&nbsp;DLL&nbsp;和&nbsp;Windows&nbsp;API&nbsp;函数；</li>
<li>可实现&nbsp;RunAs&nbsp;功能；</li>
<li>兼容大多数&nbsp;Windows&nbsp;版本；</li>
<li>支持&nbsp;Unicode&nbsp;和&nbsp;64&nbsp;位操作系统。</li>
<li>支持数字签名。</li>
<li>支持用户账户控制（&nbsp;UAC&nbsp;）。</li>
</ul>
<h2 id="2-nbsp-变种木马简介"><a href="#2-nbsp-变种木马简介" class="headerlink" title="2&nbsp;变种木马简介"></a>2&nbsp;变种木马简介</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;近期，本人通过在网上部署的各个&nbsp;VPS&nbsp;节点蜜罐，捕获到一种新型的&nbsp;Au3&nbsp;脚本木马变种。在以往，大多数以&nbsp;Au3&nbsp;编码的恶意程序攻击中，主要都是以窃取键盘输入的木马为主，比如，2016&nbsp;年腾讯电脑管家在&nbsp;FreeBuf&nbsp;上报道的&nbsp;&#x300a;<a href="http://www.freebuf.com/articles/system/119695.html" target="_blank" rel="noopener">异次元窃贼：使用AutoIt脚本进行键盘记录窃取的“新奇玩法”</a>&#x300b;&nbsp;所述。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;本次所捕获的新型变种，保留了以往的利用代码框架，但功能上明显增强，甚至还有部分神秘的功能模块可能还处于测试阶段，没有被攻击程序调用。可以认为，该新型木马变种的作者在原有的利用代码框架上，进行了增配和强化，使其完全具备远控木马的功能。甚至利用了&nbsp;Au3&nbsp;脚本自身的优越姿势，模拟人的键鼠操作，“手动”&nbsp;退出了某厂商的些杀软进程（比如国际著名的&nbsp;Avast杀毒软件）。</p>
<h2 id="3-nbsp-变种木马分析"><a href="#3-nbsp-变种木马分析" class="headerlink" title="3&nbsp;变种木马分析"></a>3&nbsp;变种木马分析</h2><h3 id="3-1-nbsp-可疑文件"><a href="#3-1-nbsp-可疑文件" class="headerlink" title="3.1&nbsp;可疑文件"></a>3.1&nbsp;可疑文件</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;可疑文件被嵌入在某文档中，以邮件的方式进行传播:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-8bf967ce8a9f0572.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="被嵌入可执行程序的文档"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;提取出可执行程序样本后，发现该样本为&nbsp;RAR&nbsp;自解压程序：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-52e43245bfe5c95d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="嵌入的可执行文件为&nbsp;RAR&nbsp;自解压程序"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;使用&nbsp;RAR&nbsp;打开后，发现攻击者在解压配置中加入了某国语言的热门小说内容来逃避杀软检测：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-884b8294f64689f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自解压配置中存在混淆信息"><br>&nbsp;&nbsp;&nbsp;&nbsp;清理解压配置中无用信息后得到配置信息如图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-0e732f768038e6ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自解压配置信息"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分析自解压的配置信息发现，当用户双击文档中嵌入的&nbsp;exe&nbsp;程序时会触发自解压程序，将压缩包文件尽数解压到&nbsp;&#x25;temp&#x25;&#x5c;xxxx&nbsp;目录下，该解压过程中的进度条被隐藏。且在解压过程中，如果遇到文件已存在的情况，则会直接覆盖（不会提示用户）。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分析解压后的文件发现，压缩包内存在各种类型的文件共二十多个， 其后缀名包括：bmp、mp3、dat、icm、jpg、ppt、docx、pdf、xl、ico、txt、exe&nbsp;等。其中，除了&nbsp;file1&#x2e;exe&nbsp;和&nbsp;file2、file3&nbsp;文件之外，其他的文件皆为文本文件：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-85971a2a2c5e7fc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="压缩包内文件类型"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;任意打开压缩包内的文本文件发现，这些文本文件的内容都是一些字符串，此处推测这些文件存在的目的可能是为了欺骗杀软对压缩包内容的检测：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-ee2b1954c7c76d2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="压缩包内的文本文件"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分析&nbsp;file1&#x2e;exe、&nbsp;file2、file3&nbsp;三个文件后发现：file1&#x2e;exe&nbsp;是&nbsp;Au3&nbsp;脚本的解释器，file2&nbsp;是&nbsp;Au3&nbsp;脚本，file3&nbsp;为&nbsp;ini&nbsp;配置文件。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;对可执行程序&nbsp;file1&#x2e;exe&nbsp;进行查杀发现，全球&nbsp;63&nbsp;款主流杀软对该文件的检出率为&nbsp;0&nbsp;。这种情况只有两种可能，一种可能是该程序确实为&nbsp;Au3&nbsp;官方发布的安全程序；另一种可能是该程序经过牛逼的免杀处理后，对全球主流杀软都具有免杀能力。这里唯一可以确定的一点是，该程序确实是&nbsp;Au3&nbsp;脚本的解释器，确实能够运行&nbsp;Au3&nbsp;脚本。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-8ab1ec5181a89622.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="file1.exe 查杀结果"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;file1&#x2e;exe&nbsp;文件的签名情况如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-ab6459766840f93d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="file1.exe 签名信息"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;直接双击运行&nbsp;file1&#x2e;exe&nbsp;时，会提示选择用户手动一个&nbsp;Au3&nbsp;脚本（来编译并执行）：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-c059edfbacc7aeb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="双击 file1.exe 时"></p>
<h3 id="3-2-nbsp-脚本分析"><a href="#3-2-nbsp-脚本分析" class="headerlink" title="3.2&nbsp;脚本分析"></a>3.2&nbsp;脚本分析</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;对&nbsp;file2&nbsp;进行分析发现，该脚本文件的源码通过大量增加无用注释（&#x3b;&nbsp;号开头的行都是单行注释）和无用代码（&#x23;&#x2d;d&#x2d;d&#x2d;d&nbsp;开头的大多是无用代码，且不干扰程序正常运行）的方式来增加内容和文件体积，此处推测目的是用于提高静态检测的难度以及使用大文件来逃避多数杀软的云查杀功能。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-0e7b85b5115a8d5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="file2 内容充满无用的注释"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;删除无用行后得到&nbsp;6&nbsp;KB&nbsp;的代码：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-97020eb9e8bea4a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="file2 源码开头"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;从代码可知，file2&nbsp;脚本运行时会加载&nbsp;file3&nbsp;的的内容，那么&nbsp;file3&nbsp;是不是程序的配置文件呢？我们载入&nbsp;file3&nbsp;来看看：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-a313259bbf55721f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="file3 文件内容片段"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;file3&nbsp;中出现了熟悉的&nbsp;&#x5b;Setting&#x5d;，没错，经过分析发现&nbsp;file3&nbsp;就是一个&nbsp;ini&nbsp;配置文件。为了后续的分析更加直观，我们接下来将&nbsp;file1&#x2e;exe&nbsp;改名为&nbsp;AutoIt3&#x2e;exe，将&nbsp;file2&nbsp;改名为&nbsp;main&#x2e;au3，将&nbsp;file3&nbsp;改名为&nbsp;config&#x2e;ini。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;研究发现，该脚本执行过程的简述如下：</p>
<ul>
<li>1&#x2e;&nbsp;当解压操作完成时，程序会自动以当前用户的权限运行&nbsp;AutoIt3&#x2e;exe&nbsp;，再由&nbsp;AutoIt3&#x2e;exe&nbsp;编译并执行脚本文件&nbsp;main&#x2e;au3。</li>
<li>2&#x2e;&nbsp;main&#x2e;au3&nbsp;脚本执行后会从配置文件&nbsp;config&#x2e;ini&nbsp;中加载加密的代码段，以及解密所需的密钥和其他配置参数。</li>
<li>3&#x2e;&nbsp;紧接着进行解密操作，在当前目录下生成一个临时文件，文件名为五位随机大写字母且每次运行生成的文件名皆不同。该临时文件被用于写入解密之后&nbsp;Au3&nbsp;脚本代码，此处我们称生成的新文件为&nbsp;attack&#x2e;au3。</li>
<li>4&#x2e;&nbsp;attack&#x2e;au3&nbsp;生成后，会立即被主程序编译并载入内存执行。新脚本运行之后随即删除自身的临时文件，并再次载入配置文件&nbsp;config&#x2e;ini。</li>
<li>5&#x2e;&nbsp;此时，会根据配置文件内的&nbsp;&#x201c;定制化配置&#x201d;&nbsp;参数，以及当前的运行环境来加载不同的攻击函数模块。为了构造攻击所需的&nbsp;&#x201c;payload&#x201d;，脚本程序会从配置文件中读取新的加密代码段及新的解密密钥。</li>
<li>6&#x2e;&nbsp;当一系列攻击操作完成时，被入侵的主机会主动向&#x20;&#x43;&#x26;&#x43;&#x20;服务器发起回连请求。</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;综上所述，整个木马程序的执行流程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+-----------+      +------------------+      +------------------+      +-------------------------+</span><br><span class="line">| User Open |      |  User dblclick   |      | extracting files |      | Auto Run:               |</span><br><span class="line">| xxxx.docx +----&gt; | xxxx.exe in docx +----&gt; | to %temp%\xxxx\* +----&gt; | ./AutoIt3.exe main.au3  |</span><br><span class="line">+-----------+      +------------------+      +------------------+      +----------+--------------+</span><br><span class="line">                                                                                  |</span><br><span class="line">                                                                                  |</span><br><span class="line">                                                                                  v</span><br><span class="line">     +--------------------------+      +--------------------------+      +-----------------+</span><br><span class="line">     | Auto Run:                |      | Creat new decode script: |      | main.au3 load:  |</span><br><span class="line">     | ./AutoIt3.exe attack.au3 | &lt;----+ attack.au3               | &lt;----+ config.ini      |</span><br><span class="line">     +----------+---------------+      +--------------------------+      +-----------------+</span><br><span class="line">                |</span><br><span class="line">                |</span><br><span class="line">                |</span><br><span class="line">                |              +-----------------------------------------+</span><br><span class="line">                |              | GAME OVER:                              |</span><br><span class="line">                +------------&gt; | Your machine connect to the C&amp;C Server! |</span><br><span class="line">                               +-----------------------------------------+</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;分析&nbsp;config&#x2e;ini&nbsp;文件发现，依然是存在混淆信息：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-18672639d7b95e67.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="&nbsp;config&#x2e;ini&nbsp;文件中存在混淆信息"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;匹配等号行发现，共有&nbsp;7&nbsp;个配置参数：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-3ed90c0a226a189a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="&nbsp;config&#x2e;ini&nbsp;文件内容片段"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;除了常规的配置外，还发现文件中大段大段的十六进制数据块上存在两对标记：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-2dd4ee5bddad2309.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标签"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;研究发现，标记内的数据为加密的十六进制数据块：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-9becf5d2b9023bd2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标签内的 HEX"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;为了方便后续的分析，&#x5b;Data&#x5d;&nbsp;标签和&nbsp;&#x5b;eData&#x5d;&nbsp;内连续的十六进制数据块<br>我们命名为HexBlock1，&#x5b;sData&#x5d;&nbsp;和&nbsp;&#x5b;esData&#x5d;&nbsp;标签内的十六进制数据块我们命名为HexBlock2。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;分析脚本文件&nbsp;main&#x2e;au3&nbsp;的源码发现，代码中加入大量双引号和&nbsp;and&nbsp;符号&nbsp;<code>&quot;&amp;&quot;</code>&nbsp;来逃避杀软的静态检测：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-03a73eb7820dafc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="逃避杀软检测"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;部分数据块也采用了临时替换组装的方式来逃避杀软的静态检测：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-ec7c67f60ce68bc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="部分加密数据块"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;解密之后为：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-45742dc23804c34d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="部分数据库解密"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;上传到云端后发现仅有2款杀软能够检测出&nbsp;main&#x2e;au3&nbsp;为恶意文件：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-4521cfc7c1f07e47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="全球仅有 2 框杀软能够检出恶意文件"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;由于样本源码不打算公开，此处仅摘取脚本中的一些函数做介绍。需要注意的是，这些函数大部分是&nbsp;Au3&nbsp;官方提供的，而具有攻击性的&nbsp;payload&nbsp;代码大部分是存储在&nbsp;DLL&nbsp;数据里面：</p>
<ul>
<li><code>#NoTrayIcon</code>：用于隐藏程序的运行状态及任务栏图标</li>
<li><code>ProcessExists</code>：此处用于判断一些杀软进程是否正在运行。</li>
<li><code>IniRead</code>：用于加载配置参数。</li>
<li><code>FileExists</code>：用于判断文件是否存在。</li>
<li><code>FileCopy</code>：用于文件复制操作。</li>
<li><code>FileRead</code>：用于读取配置文件中的加密代码块。</li>
<li><code>FileSetAttrib</code>：用于设置文件属性。</li>
<li><code>FileWrite</code>：用于写入解密后的新脚本到新文件中。</li>
<li><code>StringRegExp</code>：用于匹配正则表达式。</li>
<li><code>StringRegExpReplace</code>:用于处理正则表达式替换操作。</li>
<li><code>DllStructCreate</code>：用于创建&nbsp;DLL&nbsp;结构体。</li>
<li><code>DllStructSetData</code>：用于设置&nbsp;DLL&nbsp;结构体的数据内容。</li>
<li><code>DllStructGetPtr</code>:用于获取结构体指针。</li>
<li><code>DllStructGetData</code>：用于获取结构体的数据内容。</li>
<li><code>DllStructGetSize</code>：用于获取&nbsp;DLL&amp;nbsp某指定字节数的数据内容。</li>
<li><code>DllCall</code>：调用一个&nbsp;DLL。</li>
<li><code>DllOpen</code>：加载一个&nbsp;DLL&nbsp;文件到内存，以等待调用。</li>
<li><code>DllClose</code>：关闭一个&nbsp;DLL&nbsp;文件。</li>
<li><code>WinExists</code>：检测指定的程序窗口是否存在。</li>
<li><code>Execute</code>：用于执行操作系统命令。</li>
<li><code>ShellExecute</code>：用于执行操作系统命令。</li>
<li><code>FileDelete</code>：用于文件删除操作。</li>
<li><code>ProcessClose</code>：用于关闭进程操作。</li>
<li><code>RegDelete</code>：用于删除注册表项操作。</li>
<li><code>RegWrite</code>：用于注册表写入操作。</li>
<li><code>WinActive</code>：检测指定的程序是否正在运行。</li>
<li><code>WinWaitClose</code>：暂停执行脚本，直到指定的程序退出。</li>
<li><code>RunWait</code>：执行一个外部程序并暂停脚本自身的运行，直到所执行的外部程序完成。</li>
<li><code>WinGetText</code>：检索所有程序界面上的文字。</li>
<li><code>ClipPut</code>：将指定的数据内容写入到系统剪切板。</li>
<li><code>DriveSpaceFree</code>：显示指定磁盘的剩余空间。</li>
<li><code>InetGet</code>：从互联网上下载文件，支持&nbsp;HTTP、HTTPS、FTP&nbsp;协议。</li>
<li><code>BitShift</code>：用于数据位移操作。</li>
<li><code>BitAND</code>：用于数据与操作。</li>
</ul>
<h3 id="3-3-nbsp-进程注入"><a href="#3-3-nbsp-进程注入" class="headerlink" title="3.3&nbsp;进程注入"></a>3.3&nbsp;进程注入</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;考虑到直接拿脚本源码中的解密逻辑去提取&nbsp;DLL&nbsp;数据内容比较抽象，此处分析内容主要以逆向为主。分析发现，攻击脚本&nbsp;attack&#x2e;au3&nbsp;执行之后，会启动以下程序（优先使用v4）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v2.0.50727\RegSvcs.exe</span><br><span class="line">或者</span><br><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319\RegSvcs.exe</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;先下一波断点（API&nbsp;断点仅供参考）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bp kernel32.CreateProcessW</span><br><span class="line">bp kernel32.MoveFileA</span><br><span class="line">bp ws2_32.recv</span><br><span class="line">bp ws2_32.send</span><br><span class="line">bp Kernel32.WriteFile</span><br><span class="line">bp Kernel32.ReadProcessMemory</span><br><span class="line">bp Kernel32.WriteProcessMemory</span><br><span class="line">bp Kernel32.CreateFileW</span><br><span class="line">bp Kernel32.CreateFileA</span><br><span class="line">bp Kernel32.SetThreadContext</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;运行至启动&nbsp;RegSvcs&#x2e;exe&nbsp;程序时，观察堆栈内容：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-708b07ffac3166e4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="启动&nbsp;RegSvcs&#x2e;exe&nbsp;程序时的堆栈内容"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;观察到&nbsp;<code>CreationFlags = CREATE_SUSPENDED</code>，其作用是程序启动后便立即停止运行，只分配了内存空间。随后观察到注入的&nbsp;DLL&nbsp;数据被分成五次写入到新建的&nbsp;RegSvcs&#x2e;exe&nbsp;进程内存：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;第一次：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-4e7f1a977d616fc6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="第一次向&nbsp;RegSvcs&#x2e;exe&nbsp;进程写入&nbsp;DLL&nbsp;数据"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;第二次：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-b1ae5e89d5c4af53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="第二次向&nbsp;RegSvcs&#x2e;exe&nbsp;进程写入&nbsp;DLL&nbsp;数据"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;第三次：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-012f63647234ded0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="第三次向&nbsp;RegSvcs&#x2e;exe&nbsp;进程写入&nbsp;DLL&nbsp;数据"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;第四次：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-c360cdccd482aca0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="第四次向&nbsp;RegSvcs&#x2e;exe&nbsp;进程写入&nbsp;DLL&nbsp;数据"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;第五次：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/7053164-0b21a0b33b6aac61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="第五次向&nbsp;RegSvcs&#x2e;exe&nbsp;进程写入&nbsp;DLL&nbsp;数据"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;提取五次注入的内存块，即得到注入到&nbsp;RegSvcs&#x2e;exe&nbsp;进程的&nbsp;DLL&nbsp;完整数据，我们将其命名为&nbsp;inject&#x2e;dll。</p>
<h3 id="3-4-nbsp-远控行为"><a href="#3-4-nbsp-远控行为" class="headerlink" title="3.4&nbsp;远控行为"></a>3.4&nbsp;远控行为</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;得到&nbsp;inject&#x2e;dll&nbsp;后，发现该模块为&nbsp;C#&nbsp;源码编写，用&nbsp;dnSpy&nbsp;载入分析发现，木马运行时，首先建立与远控服务器的心跳包连接，将受害者主机的基本信息回传到木马服务器。在心跳包监听中，如果收到服务器的指令，则按照指令执行相应的代码。可接受的指令部分如下：</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>kl</td>
<td>开启&nbsp;KeyLogger&nbsp;键盘记录模块</td>
</tr>
<tr>
<td>nk</td>
<td>使用指定的密码加密通讯流量</td>
</tr>
<tr>
<td>~</td>
<td>收集当前进程信息</td>
</tr>
<tr>
<td>!</td>
<td>源码中仅声明该指令，未定义具体操作</td>
</tr>
<tr>
<td>@</td>
<td>收集本地文件夹目录&#xff08;只记录到文件夹名称，且排除系统目录&#xff09;</td>
</tr>
<tr>
<td>#</td>
<td>收集指定文件夹内文件名</td>
</tr>
<tr>
<td>up</td>
<td>上传指定文件到服务器</td>
</tr>
<tr>
<td>dl</td>
<td>下载指定文件到受害者主机</td>
</tr>
<tr>
<td>Ex</td>
<td>执行系统命令或运行某程序</td>
</tr>
<tr>
<td>rb</td>
<td>在注册表中注册开启自启</td>
</tr>
<tr>
<td>mmm</td>
<td>退出自身进程</td>
</tr>
<tr>
<td>%-</td>
<td>尝试关闭指定进程</td>
</tr>
</tbody></table>
<p>&nbsp;&nbsp;&nbsp;&nbsp;此外，源码中有些函数虽然定义了功能，但没有写调用代码，此处不做详细说明。此外，该远控木马客户端上线时，回传本机基础信息使用的是&nbsp;BASE64&nbsp;编码来加密流量：<br><img src="http://upload-images.jianshu.io/upload_images/7053164-3390b90224628fbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="木马回连通信"></p>
<h2 id="4-nbsp-免杀思路总结"><a href="#4-nbsp-免杀思路总结" class="headerlink" title="4&nbsp;免杀思路总结"></a>4&nbsp;免杀思路总结</h2><ul>
<li>1.在自解压注释中，通过增加正常的小说文本来干扰杀软的识别。</li>
<li>2.解压的文件中，使用了二十多种后缀名，伪装普通的办公文件、图片文件、视频文件和文本文件。</li>
<li>3.解压的文件中，唯一的可执行文件是带了数字签名的&nbsp;Au3&nbsp;脚本解释器。</li>
<li>4.解压的文件中，大多数文件皆为无用的随机字符串。</li>
<li>5.主要执行的脚本文件中，增加了大量无用的注释行，以及不影响代码执行的非代码行。</li>
<li>6.主要执行的脚本文件自身体积近&nbsp;3M，多数云查杀对该大小的文件内容不进行在线检测。</li>
<li>7.主要执行的脚本文件中，对所用到的&nbsp;Au3&nbsp;敏感函数、敏感字符串、二进制数据库都采用了以双引号和&nbsp;AND&nbsp;符号构成的&nbsp;<code>&quot;&amp;&quot;</code>&nbsp;字符串进行分割。</li>
<li>8.在最终攻击代码的生成前，主程序会利用&nbsp;Au3&nbsp;脚本自身的优越姿势，模拟人的键鼠操作，“手动”&nbsp;退出了某厂商的些杀软进程（比如国际著名的&nbsp;Avast杀毒软件）。</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;对该木马的免杀思路总结大概就是这几条，当程序开始往进程注入&nbsp;DLL&nbsp;时，已是赤裸裸的进攻，不再具备免杀特性。</p>
<h2 id="5-nbsp-攻击来源分析"><a href="#5-nbsp-攻击来源分析" class="headerlink" title="5&nbsp;攻击来源分析"></a>5&nbsp;攻击来源分析</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;攻击者使用的远控服务的&nbsp;IP&nbsp;地址为&nbsp;&#x31;&#x39;&#x32;&#x2e;&#x36;&#x38;&#x2e;&#x78;&#x2e;&#x78;&nbsp;，所在地为瑞典，使用的通讯协议为&nbsp;tcp&nbsp;，端口&nbsp;7771：<br><img src="http://upload-images.jianshu.io/upload_images/7053164-ba036f187d257473.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="攻击者IP地址"></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;根据第三方情报数据显示，该远控端&nbsp;IP&nbsp;早在&nbsp;2016&nbsp;年就被捕获过可疑行为：<br><img src="http://upload-images.jianshu.io/upload_images/7053164-29efa904d6b5b27e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开源情报"></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;更多内容请关注：<a href="http://bruce.wang" target="_blank" rel="noopener">王小龍的博客</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/威胁分析/" rel="tag"># 威胁分析</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/01/Struts 2 漏洞系列之 S2-001/" rel="next" title="Struts 2 漏洞系列之 S2-001">
                <i class="fa fa-chevron-left"></i> Struts 2 漏洞系列之 S2-001
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/11/Struts 2 漏洞系列之 S2-002/" rel="prev" title="Struts 2 漏洞系列之 S2-002">
                Struts 2 漏洞系列之 S2-002 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">BruceWang</p>
              <p class="site-description motion-element" itemprop="description">filtering noise and focusing on threats</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-nbsp-Au3-nbsp-简介"><span class="nav-number">1.</span> <span class="nav-text">1 Au3 简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-nbsp-变种木马简介"><span class="nav-number">2.</span> <span class="nav-text">2 变种木马简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-nbsp-变种木马分析"><span class="nav-number">3.</span> <span class="nav-text">3 变种木马分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-nbsp-可疑文件"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 可疑文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-nbsp-脚本分析"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 脚本分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-nbsp-进程注入"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 进程注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-nbsp-远控行为"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 远控行为</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-nbsp-免杀思路总结"><span class="nav-number">4.</span> <span class="nav-text">4 免杀思路总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-nbsp-攻击来源分析"><span class="nav-number">5.</span> <span class="nav-text">5 攻击来源分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">6.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BruceWang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
